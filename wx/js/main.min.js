$(function(){var t="http://tk.jetcloudtech.com";jq.ajaxSetup({xhrFields:{withCredentials:!0},crossDomain:!0}),$(document).on("pageInit",function(t,s,c){"index"==s&&(e.init(),e.bindEvents()),"stadium_detail"==s&&o.getDetail(),"action_detail"==s&&(n.getDetail(),n.bindEvents()),"choose_seat"==s&&(n.couponList=[],n.reset(),n.getTime(),n.bindEvents()),"choose_coupon"==s&&(n.initWxPay(),n.reset(),n.getTime(),n.bindEvents()),"pay"==s&&(n.initPay(),n.initWxPay(),n.bindEvents()),"order_success"==s&&n.orderSuccess(),"couponCode"==s&&(n.showCoupon(),n.bindEvents()),"address"==s&&($(".address_list").addClass("hide"),i.getAllAddress(),i.bindEvents()),"addAddress"==s&&(i.initCity(),i.bindEvents()),"order"==s&&($.showPreloader(),a.getAllOrder(),a.bindEvents()),"ticketList"==s&&(a.getAllTicket(),a.bindEvents()),"couponList"==s&&(a.getAllCoupon(),a.bindEvents())});var e={init:function(){this.getStadiums(),this.getActions()},getStadiums:function(){jq.ajax({type:"get",url:t+"/sites.json/",success:function(t){t?e.stadiumSuccess(t):e.stadiumError()},error:function(t){e.stadiumError()}})},stadiumSuccess:function(t){t.map(function(t){t.pic_url=t.pic_url.replace("/sites.json/","/")});var o=["{{#each stadium}}","<div>",'<img src="{{pic_url}}" class="bantu marb stadiumsDetail" url="{{url}}" />',"</div>","{{/each}}"].join(""),n=Handlebars.compile(o),i={stadium:t},a=n(i);$(".stadiums_list").html(a),e.bindEvents()},stadiumError:function(){var t=['<button class="button button-warning stadium_error widthAll mart1">',"页面加载失败,请点击重新加载页面","</button>"].join("");$(".stadiums_list").html(t),e.bindEvents()},getActions:function(){jq.ajax({type:"get",url:t+"/actions.json/?state=1",success:function(t){t?e.actionSuccess(t):e.actionError()},error:function(t){e.actionError()}})},actionSuccess:function(t){if(0!=t.length){t.sort(function(t,e){return e.pk-t.pk}),t.map(function(t,e){t.pic=t.pic.replace("/actions.json/","/"),t.pic1=t.pic1.replace("/actions.json/","/"),t.index=e}),n.info=t;var o=["{{#each actions}}","<div>",'<img src="{{pic}}" class="bantu marb actionsDetail" index="{{index}}" pk="{{pk}}" />',"</div>","{{/each}}"].join(""),i=Handlebars.compile(o),a={actions:t},s=i(a);$(".last_action").attr("src",t[0].pic).attr("index",t[0].index).attr("pk",t[0].pk);for(var c="",r=1;r<t.length;r++){var l=['<img class="bantu marb check_action" src="',t[r].pic+'"','index="',t[r].index+'"','pk="',t[r].pk+'">'].join("");c+=l}$(".pre_list").html(c),$(".actions_list").html(s),e.bindEvents()}},actionError:function(){var t=['<button class="button button-warning action_error widthAll mart1">',"页面加载失败,请点击重新加载页面","</button>"].join("");$(".actions_list").html(t),e.bindEvents()},bindEvents:function(){$(".actionsDetail").off("click").on("click",function(t){n.index=$(t.target).attr("index"),n.pk=$(t.target).attr("pk"),$.router.load("modules/action/actionDetail")}),$(".stadiumsDetail").off("click").on("click",function(t){sessionStorage.setItem("stadiumInfo",$(t.target).attr("url")),$.router.load("modules/stadium/stadiumDetail")}),$(".stadium_error").off("click").on("click",function(t){e.getStadiums()}),$(".action_error").off("click").on("click",function(t){e.getActions()}),$(".last_action").off("click").on("click",function(t){n.index=$(t.target).attr("index"),n.pk=$(t.target).attr("pk"),$.router.load("modules/action/actionDetail")}),$(".check_action").off("click").on("click",function(t){n.index=$(t.target).attr("index"),n.pk=$(t.target).attr("pk"),$.router.load("modules/action/actionDetail")})}},o={getDetail:function(){jq.ajax({type:"get",url:sessionStorage.getItem("stadiumInfo"),success:function(t){t?o.detailSuccess(t):o.detailError()},error:function(t){o.detailError()}})},detailSuccess:function(t){t.pic_url=t.pic_url.replace("/sites/","/"),$("#stadium_detail .pic").attr("src",t.pic_url),$("#stadium_detail .name").text(t.name),$("#stadium_detail .introduce").text(t.remark),$("#stadium_detail .address").text(t.addr),sessionStorage.removeItem("stadiumInfo")},detailError:function(){$("#stadium_detail .done").addClass("hide"),$("#stadium_detail .err").removeClass("hide")},bindEvents:function(){$("#stadium_detail .detail_error").off("click").on("click",function(){o.getDetail()})}},n={index:0,pk:0,info:[],time:[],order:{},couponList:[],initWxPay:function(){var e=window.location.href;jq.ajax({url:t+"/wechat/get_jsapi_ticket/?url="+e,type:"get",success:function(t){wx.config({debug:!1,appId:t.appid,timestamp:t.timestamp,nonceStr:t.noncestr,signature:t.key,jsApiList:["chooseWXPay","getLocation","openLocation"]})},error:function(){alert("js签名请求错误")}})},wxPay:function(e,o){jq.ajax({type:"get",url:t+e,success:function(t){wx.checkJsApi({jsApiList:["chooseWXPay"],success:function(e){e.checkResult.chooseWXPay?wx.chooseWXPay({appId:t.appId,timestamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.sgin,success:function(t){$.hidePreloader(),"ticket"==o?$.router.load("../../order/ticket"):"coupon"==o&&$.router.load("../../order/coupon")}}):($.hidePreloader(),console.log("微信版本不支持支付接口或没有开启！"))},error:function(){$.hidePreloader(),console.log("调用 checkJsApi 接口时发生错误!")}})},error:function(){$.hidePreloader(),alert("调用支付失败")}}),setTimeout(function(){$.hidePreloader()},2e3)},initSeat:function(t){function e(e){var o=0;return e.find("selected").each(function(){o+=t.price}),o.toFixed(2)}for(var o=jq("#selected-seats"),n=jq("#counter"),i=jq("#total"),a=jq("#seat-map").seatCharts({map:JSON.parse(t.map),seats:{a:{price:t.price},b:{classes:"unavailable"}},legend:{node:jq("#legend"),items:[["a","available","可选"],["a","unavailable","已售"]]},naming:{data:JSON.parse(t.map)},click:function(){return"available"==this.status()?(jq("<li>"+(this.settings.row+1)+"排"+this.settings.label+"座</li>").attr("id","cart-item-"+this.settings.id).attr("position",this.settings.id).data("seatId",this.settings.id).appendTo(o),n.text(a.find("selected").length+1),i.text((+e(a)+t.price).toFixed(2)),"selected"):"selected"==this.status()?(n.text(a.find("selected").length-1),i.text((+e(a)-t.price).toFixed(2)),jq("#cart-item-"+this.settings.id).remove(),"available"):"unavailable"==this.status()?"unavailable":this.style()},focus:function(){return"available"==this.status()?"focused":this.style()},blur:function(){return this.status()}}),s=jq("#seat-map").find(".unavailable"),c=[],r=0;r<s.length;r++)c.push($(s[r]).attr("id"));a.get(c).status("unavailable")},initPay:function(){var t=n.order;$(".cost_total").text(t.cost_total),$(".total").text(t.total),$(".posi03").css("backgroundImage","url("+t.showInfo.pic+")"),$(".pic").attr("src",t.showInfo.pic1),$(".name").text(t.showInfo.name),$(".time").text(t.time_name),$(".site").text(t.showInfo.site),$(".addr").text(t.showInfo.siteAddr),$(".num").text(t.num);var e=[];t.list.forEach(function(o){e.push('<p class="ubb padr text-center">'),e.push('<span class="pull-left">'+t.area_name+"</span>"),e.push(o),e.push('<span class="pull-right">'+t.price+"元</span>"),e.push("</p>")}),t.cost_total=t.total,0!=n.couponList.length?($(".coupon_num").text(n.couponList.length),n.couponList.forEach(function(e){t.cost_total-=+e.coupon_price}),+t.cost_total<=0&&(t.cost_total=0)):$(".coupon_num").text("0"),$(".cost_total").text(t.cost_total.toFixed(2)),$(".seat_list").html(e.join(""))},getDetail:function(){n.time=[],jq.ajax({type:"get",url:t+"/ActionNumGtCurTime/?state=1&action="+n.pk,success:function(t){0==t.length?($.toast("暂无该活动演出场次"),$.router.back()):t.length>0?n.detailSuccess(t):n.detailError()},error:function(t){n.detailError()}})},detailSuccess:function(t){var e=n.info[n.index];$("#action_detail .pic").attr("src",e.pic1),$("#action_detail .posi01").css("background","url("+e.pic+") no-repeat"),$("#action_detail .name").text(e.name),$("#action_detail .addr").text(e.site),$("#action_detail .introduce").text(e.introduce);var o=[];t.forEach(function(t){t.perform_date=t.perform_date.replace(/[tz]/gi," ").substring(0,16),n.time.push(t),o.push(t.perform_date)}),$("#action_detail .showtime").html(o.join("<br>"))},detailError:function(){$.toast("获取演出时间失败,请刷新重试!")},getTime:function(){var t="<option value='' selected>请选择场次</option>";n.time.forEach(function(e){t+="<option value='"+e.pk+"'>"+e.perform_date+"</option>"}),$("#choose_time").html(t)},getArea:function(e){$("#choose_area").html(""),jq.ajax({type:"get",url:t+"/areaAndPrice/?pk="+e,success:function(t){0!=t.length?n.areaSuccess(t):n.areaError()},error:function(t){n.areaError()}})},areaSuccess:function(t){var e="<option value='' selected>请选择区域</option>";t.forEach(function(t){e+="<option value='"+t.string2+"' price='"+t.price+"' pk='"+t.pk+"'>"+t.name+"&emsp;"+t.price+"元</option>"}),$("#choose_area").html(e)},areaError:function(){$.toast("获取区域失败,请刷新重试!")},settleTicket:function(e){jq.ajax({type:"post",url:t+"/buyTicket/",data:JSON.stringify(e),success:function(t){if("10000"==t.status)0==e.cost_total?($.hidePreloader(),$.router.load("../../order/ticket")):n.time=n.ticketSuccess(t);else if("10001"==t.status){var o=t.seat_num.split("_");$.hidePreloader(),$.toast(o[0]+"排"+o[1]+"号 座位已经被预定..."),$.router.load("../../action/chooseSeat")}else $.hidePreloader(),$.toast("提交订单失败")},error:function(t){$.hidePreloader(),$.toast("提交订单失败")}})},ticketSuccess:function(t){var e="/wechat/unifiedorder/?orderNo="+t.order_no+"&body=买票款项&detail=汝来支付&attach=汝来票券&payprice="+t.total_price;n.wxPay(e,"ticket")},orderSuccess:function(){var t=n.order;$(".order_id").text(t.order_id),$(".name").text(t.showInfo.name),$(".site").text(t.showInfo.site),$(".addr").text(t.showInfo.siteAddr),$(".time").text(t.time_name),$(".area").text(t.area_name.substring(0,3)),$(".position").text(t.list.join("&emsp;")),$(".total").text(t.total),$(".num").text(t.num),$(".pic_code").attr("src",t.pic_code)},settleCoupon:function(e){jq.ajax({type:"post",url:t+"/buyCoupon/",data:JSON.stringify(e),success:function(t){t.order_no?n.couponSuccess(t):($.hidePreloader(),$.toast("购买失败.请重试"))},error:function(t){$.hidePreloader(),$.toast("购买失败.请重试")}})},couponSuccess:function(t){var e="/wechat/unifiedorder/?orderNo="+t.order_no+"&body=优惠券款项&detail=汝来支付&attach=汝来优惠券&payprice="+t.total_price;n.wxPay(e,"coupon")},showCoupon:function(){n.couponList=[],$(".coupon_list").html("");var e=n.order.time;e?jq.ajax({type:"get",url:t+"/coupons/?state=0&actionnum="+e,success:function(t){n.showCouponSuccess(t)},error:function(){$.toast("获取优惠券码失败,请重新进入"),$.router.back()}}):($.toast("获取优惠券码失败,请重新进入"),$.router.back())},showCouponSuccess:function(t){if(0!=t.length){var e=[];t.forEach(function(t){var o=['<li class="item-content">','<label class="item-inner">','<input type="checkbox" name="coupon">','<div class="item-title">','<span class="pk">'+t.pk+"</span>:&ensp;",'编号:<span class="coupon_no">'+t.coupon_no+"</span>&ensp;",'面额:<span class="coupon_money">'+t.coupon_price+"</span>","</div>","</label>","</li>"].join("");e.push(o)}),console.log(e.join("")),$(".coupon_list").html(e.join("")),$("label.item-inner").off("change").on("change",function(t){var e=jq(t.target).next().find(".pk").text();if(jq(t.target).prop("checked")){var o=jq(t.target).next().find(".coupon_money").text(),i=jq(t.target).next().find(".coupon_no").text();n.couponList.push({pk:e,coupon_no:i,coupon_price:o})}else n.couponList=n.couponList.filter(function(t){if(t.pk!=e)return t})})}else $.toast("你还没有任何优惠券哟！"),$(".coupon_list").html("")},useCoupon:function(e){$.showPreloader("正在验证优惠券...");var o={coupon_no:e,actionnum_id:n.order.time};jq.ajax({type:"post",url:t+"/checkCoupon/",data:JSON.stringify(o),success:function(t){if(0==t.status){$.toast("添加优惠券码成功");var e=['<li class="item-content">','<label class="item-inner">','<input type="checkbox" checked>','<div class="item-title">','编号:<span class="coupon_no">'+t.coupon_no+"</span>&ensp;",'面额:<span class="coupon_money">'+t.coupon_price+"</span>","</div>","</label>","</li>"].join("");$(".tip").addClass("hide"),$(".coupon_list").append(e),n.couponList.push(t)}else 1==t.status?$.toast("优惠券码场次不匹配,请重新输入"):2==t.status?$.toast("优惠券码已使用,请重新输入"):$.toast("优惠券码无效,请重新输入");$.hidePreloader()},error:function(){$.toast("优惠券码无效,请重新输入"),$.hidePreloader()}})},bindEvents:function(){$("#choose_time").off("change").on("change",function(){var t=$("#choose_time").val();$("#seat-map").addClass("hide").html(""),$("#selected-seats").html(""),$("#counter").text("0"),$("#total").text("0"),t?n.getArea(t):($.toast("请选择场次"),$("#choose_area").html(""),$("#seat-map").html(""),$("#legend").html(""),$("#selected-seats").html(""),$("#counter").text(""),$("#total").text("0"),$("#selected-coupon").html(""),$("#counter_total").text("0"),$("#coupon_num").val(""),$("#coupon_total").text("0"))}),$("#choose_area").off("change").on("change",function(){var t=$("#choose_time").val();if(!t)return $.toast("请先选择场次"),void($("#choose_time").selectedIndex=0);var e=jq("#choose_area :selected").val();if($("#seat-map").addClass("hide").html(""),$("#selected-seats").html(""),$("#counter").text("0"),$("#total").text("0"),$("#coupon_num").val(""),e){var o={map:e,price:+jq("#choose_area :selected").attr("price")};$("#seat-map").removeClass("hide"),n.initSeat(o)}else $.toast("请选择区域")}),$(".buy_coupon").off("click").on("click",function(){var t=jq("#choose_time option:selected").html(),e=jq("#choose_time :selected").val(),o=jq("#choose_area option:selected").html(),n=jq("#choose_area :selected").attr("pk"),i=jq("#choose_area :selected").attr("price"),a=jq("#coupon_num").val(),s=+jq("#counter_total").text()||0,c=+jq("#coupon_total").text()||0;if(e)if(n)if(!a||a<=0)$.toast("请输入大于0的整字");else{var r=$("#selected-coupon");$('<li><a class="create-actions">场次:'+t+"&emsp;区域:"+o+"&emsp;张数:"+a+"</a></li>").attr("time",e).attr("area",n).attr("num",a).attr("price",i).appendTo(r),s+=+a,c+=+i*+a,jq("#counter_total").text(s),jq("#coupon_total").text(c.toFixed(2)),$(".create-actions").off("click").on("click",function(t){var e=[{text:"删除",bold:!0,color:"danger",onClick:function(){var e=$(t.target).parent(),o=e.attr("price"),n=e.attr("num");s-=+n,c-=+o*+n,jq("#counter_total").text(s),jq("#coupon_total").text(c.toFixed(2)),e.remove()}}],o=[{text:"取消",bg:"danger"}],n=[e,o];$.actions(n)})}else $.toast("请选择区域");else $.toast("请选择场次")}),$(".settle_coupon").off("click").on("click",function(){var t=$("#selected-coupon li");if(0==t.length)return void $.toast("购买券卡不能为空");var e=[];t.forEach(function(t){for(var o=$(t).attr("num").toString(),n=0;n<+o;n++)e.push({action_num_id:$(t).attr("time").toString(),area_id:$(t).attr("area").toString()})}),$.showPreloader("正在请求支付,请稍等..."),n.settleCoupon(e)}),$(".settle_ticket").off("click").on("click",function(){var t=jq("#choose_time option:selected").html(),e=jq("#choose_time :selected").val(),o=jq("#choose_area option:selected").html(),i=jq("#choose_area :selected").attr("pk"),a=jq("#choose_area :selected").attr("price"),s=jq("#counter").text(),c=+jq("#total").text(),r=$("#selected-seats li"),l=[],d=[];r.forEach(function(t){l.push($(t).html()),d.push($(t).attr("position").toString())}),0==l.length?$.toast("请先选择座位"):(n.order={showInfo:n.info[n.index],time_name:t,time:e,area_name:o,area:i,price:a,num:s,total:c,cost_total:c,list:l,list_position:d},$.router.load("../action/indent/"))}),$(".prompt-ok").off("click").on("click",function(){$.prompt("请输入优惠码:",function(t){n.useCoupon(t.trim())})}),$(".pay_order").off("click").on("click",function(){var t={coupon:[],selgift:[],ticket:[],cost_total:0},e=n.order.list_position,o=n.order.time,i=n.order.area,a=n.order.cost_total,s=[];if(e.forEach(function(t){s.push({action_num_id:o,area_id:i,seat_num:t})}),t.ticket=s,0!=n.couponList.length){var c=[];n.couponList.forEach(function(t){c.push({pk:t.pk})}),t.coupon=c}t.cost_total=a,$.showPreloader("正在请求支付,请稍等..."),n.settleTicket(t)})},reset:function(){$("#seat-map").addClass("hide").html(""),$("#choose_area").html(""),$("#choose_time").html(""),$("#legend").html(""),$("#selected-seats").html(""),$("#counter").text(""),$("#total").text("0"),$("#selected-coupon").html(""),$("#counter_total").text("0"),$("#coupon_num").val(""),$("#coupon_total").text("0")}},i={getAllAddress:function(){jq.ajax({type:"get",url:t+"/deliveraddrs/",success:function(t){t?i.getAddressSuccess(t):i.getAddressError()},error:function(t){i.getAddressError()}})},getAddressSuccess:function(t){t&&($(".name").text(t[0].relationpeople),$(".phone").text(t[0].iphone),$(".addr").text(t[0].deliver_addr),$(".address_list").removeClass("hide"))},getAddressError:function(){var t=['<button class="button button-warning get_address_error widthAll mart1">',"页面加载失败,请点击重新加载页面","</button>"].join("");$(".address_list").removeClass("hide").html(t),this.bindEvents()},initCity:function(){$(".city-picker").cityPicker({toolbarTemplate:'<header class="bar bar-nav">                <button class="button button-link pull-right close-picker">确定</button>                <h1 class="title">选择收货地址</h1>                </header>'})},addAddress:function(e){jq.ajax({type:"post",url:t+"/addDeliverAddr/",data:JSON.stringify(e),success:function(t){"success"==t.status?($.toast("添加地址成功"),$.router.back()):"relogin"==t.status?$.toast("请退出重新登录"):$.toast("添加地址失败,请重试")},error:function(t){$.toast("添加地址失败,请重试")}})},deleteAddress:function(e){jq.ajax({type:"get",url:t+"/deleteDeliverAddr/",data:e,success:function(t){"success"==t.status?($.toast("删除地址成功"),i.getAllAddress()):"relogin"==t.status?($.toast("请退出重新登录"),$.router.load("index")):$.toast("删除地址失败,请重试")},error:function(t){$.toast("删除地址失败,请重试")}})},bindEvents:function(){$(".get_address_error").off("click").on("click",function(){i.getAllAddress()}),$(".save_address").off("click").on("click",function(){var t={relationpeople:$("#addAddress .name").val(),iphone:$("#addAddress .phone").val(),deliver_addr:$("#addAddress .city-picker").val()+$("#addAddress .addrDetail").val()};11!=t.iphone.length?$.toast("请填写11位手机号码"):t.relationpeople&&t.iphone&&t.deliver_addr?i.addAddress(t):$.toast("请填写所有数据")}),$(".delete_address").off("click").on("click",function(t){$.confirm("确认该收货地址?",function(){i.deleteAddress()})})}},a={getAllOrder:function(){jq.ajax({type:"get",url:t+"/WxOrderByUser/",success:function(t){t?a.orderSuccess(t):a.orderError()},error:function(t){a.orderError()}}),setTimeout(function(){$.hidePreloader()},5e3)},orderSuccess:function(t){var e=$("#order .order_list"),o=[];if(e.html(""),0==t.length){var n=['<li class="card">','<div class="card-content">','<div class="card-content-inner">','<p class="l_height" style="text-align: center">您还未完成订单</p>',"</div>","</div>","</li>"].join("");o.push(n)}else t.sort(function(t,e){return e.pk-t.pk}),t.forEach(function(t){t.state="1"==t.state?"交易成功":"交易未完成",t.type="1"==t.type?"座位票":"优惠券",t.time=t.detail[0].actionnumjson.perform_date.replace(/[T]/gi," ");var e=['<li class="card">','<div class="card-header">','<span class="hong">'+t.state+"</span>","</div>",'<div class="card-content">','<div class="card-content-inner">','<p class="l_height">演出:'+t.detail[0].actionjson.name+"</p>",'<p class="l_height">场馆:'+t.detail[0].actionjson.site+"</p>",'<p class="l_height">区域:'+t.detail[0].areajson.name+"</p>",'<p class="l_height">时间:'+t.time+"</p>",'<p class="l_height">总价:'+t.real_price+"元</p>",'<p class="l_height">类型:'+t.type+"</p>",'<p class="l_height">票数:'+t.detail.length+"张</p>","</div>","</div>","</li>"].join("");o.push(e)});e.html(o.join("")),$.hidePreloader()},orderError:function(){var t=['<button class="button button-warning order_error widthAll mart1">',"页面加载失败,请点击重新加载页面","</button>"].join("");$(".order_list").html(t),$.hidePreloader(),a.bindEvents()},getAllTicket:function(){$.showPreloader(),jq(".ticketList").html(""),jq.ajax({type:"get",url:t+"/usertickets/",success:function(t){t?a.ticketSuccess(t):a.ticketError()},error:function(t){a.ticketError()}}),setTimeout(function(){$.hidePreloader()},5e3)},ticketSuccess:function(e){var o=jq(".ticketList"),n=[];if(0==e.length){var i=['<li class="card">','<div class="card-content">','<div class="card-content-inner">','<p class="l_height" style="text-align: center">您还未购买座位</p>',"</div>","</div>","</li>"].join("");n.push(i)}else e.sort(function(t,e){return e.pk-t.pk}),e.forEach(function(e){e.actionnumjson.perform_date=e.actionnumjson.perform_date.replace(/[tz]/gi," "),e.state="0"==e.state?"未使用":"已使用",e.seat_num=e.seat_num.split("_")[0]+"排"+e.seat_num.split("_")[1]+"号";var o=['<li class="card demo-card-header-pic">','<div valign="bottom" class="card-header color-white no-border no-padding">','<img class="card-cover" src="'+t+"/"+e.twodimension_pic+'">',"</div>",'<div class="card-content">','<div class="card-content-inner">','<p class="l_height">演出名:'+e.actionjson.name+"</p>",'<p class="l_height">场馆:'+e.actionjson.site+"</p>",'<p class="l_height">演出时间:'+e.actionnumjson.perform_date+"</p>",'<p class="l_height">区域:'+e.areajson.name+"</p>",'<p class="l_height">座位号:'+e.seat_num+"</p>",'<p class="l_height">使用状态:<span class="hong">'+e.state+"</span></p>","</div>","</div>","</li>"].join("");n.push(o)});o.html(n.join("")),$.hidePreloader()},ticketError:function(){var t=['<button class="button button-warning ticket_error widthAll mart1">',"页面加载失败,请点击重新加载页面","</button>"].join("");jq(".ticket_list").html(t),$.hidePreloader(),a.bindEvents()},getAllCoupon:function(){$.showPreloader(),jq(".couponList").html(""),jq.ajax({type:"get",url:t+"/coupons/",success:function(t){t?a.couponSuccess(t):a.couponError()},error:function(t){a.couponError()}}),setTimeout(function(){$.hidePreloader()},5e3)},couponSuccess:function(t){var e=jq(".couponList"),o=[];if(0==t.length){var n=['<li class="card">','<div class="card-content">','<div class="card-content-inner">','<p class="l_height" style="text-align: center">您还未购买优惠券</p>',"</div>","</div>","</li>"].join("");o.push(n)}else t.sort(function(t,e){return e.pk-t.pk}),t.forEach(function(t){t.actionnum.perform_date=t.actionnum.perform_date.replace(/[tz]/gi," "),t.state="0"==t.state?"未使用":"已使用";var e=['<li class="card">','<div class="card-content">','<div class="card-content-inner">','<p class="l_height">演出名:'+t.action.name+"</p>",'<p class="l_height">场馆:'+t.action.site+"</p>",'<p class="l_height">演出时间:'+t.actionnum.perform_date+"</p>",'<p class="l_height">优惠码:'+t.coupon_no+"</p>",'<p class="l_height">面额:'+t.coupon_price+"元</p>",'<p class="l_height">使用状态:<span class="hong">'+t.state+"</span></p>","</div>","</div>","</li>"].join("");o.push(e)});e.html(o.join("")),$.hidePreloader()},couponError:function(){var t=['<button class="button button-warning coupon_error widthAll mart1">',"页面加载失败,请点击重新加载页面","</button>"].join("");jq(".coupon_list").html(t),$.hidePreloader(),a.bindEvents()},bindEvents:function(){$(".order_error").off("click").on("click",function(){a.getAllOrder()}),$(".ticket_error").off("click").on("click",function(){a.getAllTicket()}),$(".coupon_error").off("click").on("click",function(){a.getAllCoupon()})}};$.init()});