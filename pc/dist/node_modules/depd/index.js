/*!
 * depd
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */

function containsNamespace(e,r){var t=e.split(/[ ,]+/);r=String(r).toLowerCase();for(var a=0;a<t.length;a++)if((e=t[a])&&("*"===e||e.toLowerCase()===r))return!0;return!1}function convertDataDescriptorToAccessor(e,r,t){var a=Object.getOwnPropertyDescriptor(e,r),n=a.value;return a.get=function(){return n},a.writable&&(a.set=function(e){return n=e}),delete a.value,delete a.writable,Object.defineProperty(e,r,a),a}function createArgumentsString(e){for(var r="",t=0;t<e;t++)r+=", arg"+t;return r.substr(2)}function createStackString(e){var r=this.name+": "+this.namespace;this.message&&(r+=" deprecated "+this.message);for(var t=0;t<e.length;t++)r+="\n    at "+callSiteToString(e[t]);return r}function depd(e){function r(e){log.call(r,e)}if(!e)throw new TypeError("argument namespace is required");var t=getStack(),a=callSiteLocation(t[1]),n=a[0];return r._file=n,r._ignored=isignored(e),r._namespace=e,r._traced=istraced(e),r._warned=Object.create(null),r.function=wrapfunction,r.property=wrapproperty,r}function isignored(e){if(process.noDeprecation)return!0;var r=process.env.NO_DEPRECATION||"";return containsNamespace(r,e)}function istraced(e){if(process.traceDeprecation)return!0;var r=process.env.TRACE_DEPRECATION||"";return containsNamespace(r,e)}function log(e,r){var t=0!==eventListenerCount(process,"deprecation");if(t||!this._ignored){var a,n,i,o=0,c=!1,s=getStack(),u=this._file;for(r?(i=callSiteLocation(s[1]),i.name=r.name,u=i[0]):(o=2,r=callSiteLocation(s[o]),i=r);o<s.length;o++)if(a=callSiteLocation(s[o]),n=a[0],n===u)c=!0;else if(n===this._file)u=this._file;else if(c)break;var l=a?r.join(":")+"__"+a.join(":"):void 0;if(!(void 0!==l&&l in this._warned)){if(this._warned[l]=!0,e||(e=defaultMessage(i!==r&&i.name?i:r)),t){var f=DeprecationError(this._namespace,e,s.slice(o));return void process.emit("deprecation",f)}var p=process.stderr.isTTY?formatColor:formatPlain,m=p.call(this,e,a,s.slice(o));process.stderr.write(m+"\n","utf8")}}}function callSiteLocation(e){var r=e.getFileName()||"<anonymous>",t=e.getLineNumber(),a=e.getColumnNumber();e.isEval()&&(r=e.getEvalOrigin()+", "+r);var n=[r,t,a];return n.callSite=e,n.name=e.getFunctionName(),n}function defaultMessage(e){var r=e.callSite,t=e.name;t||(t="<anonymous@"+formatLocation(e)+">");var a=r.getThis(),n=a&&r.getTypeName();return"Object"===n&&(n=void 0),"Function"===n&&(n=a.name||n),n&&r.getMethodName()?n+"."+t:t}function formatPlain(e,r,t){var a=(new Date).toUTCString(),n=a+" "+this._namespace+" deprecated "+e;if(this._traced){for(var i=0;i<t.length;i++)n+="\n    at "+callSiteToString(t[i]);return n}return r&&(n+=" at "+formatLocation(r)),n}function formatColor(e,r,t){var a="[36;1m"+this._namespace+"[22;39m [33;1mdeprecated[22;39m [0m"+e+"[39m";if(this._traced){for(var n=0;n<t.length;n++)a+="\n    [36mat "+callSiteToString(t[n])+"[39m";return a}return r&&(a+=" [36m"+formatLocation(r)+"[39m"),a}function formatLocation(e){return relative(basePath,e[0])+":"+e[1]+":"+e[2]}function getStack(){var e=Error.stackTraceLimit,r={},t=Error.prepareStackTrace;Error.prepareStackTrace=prepareObjectStackTrace,Error.stackTraceLimit=Math.max(10,e),Error.captureStackTrace(r);var a=r.stack.slice(1);return Error.prepareStackTrace=t,Error.stackTraceLimit=e,a}function prepareObjectStackTrace(e,r){return r}function wrapfunction(fn,message){if("function"!=typeof fn)throw new TypeError("argument fn must be a function");var args=createArgumentsString(fn.length),deprecate=this,stack=getStack(),site=callSiteLocation(stack[1]);site.name=fn.name;var deprecatedfn=eval("(function ("+args+') {\n"use strict"\nlog.call(deprecate, message, site)\nreturn fn.apply(this, arguments)\n})');return deprecatedfn}function wrapproperty(e,r,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("argument obj must be object");var a=Object.getOwnPropertyDescriptor(e,r);if(!a)throw new TypeError("must call property on owner object");if(!a.configurable)throw new TypeError("property must be configurable");var n=this,i=getStack(),o=callSiteLocation(i[1]);o.name=r,"value"in a&&(a=convertDataDescriptorToAccessor(e,r,t));var c=a.get,s=a.set;"function"==typeof c&&(a.get=function(){return log.call(n,t,o),c.apply(this,arguments)}),"function"==typeof s&&(a.set=function(){return log.call(n,t,o),s.apply(this,arguments)}),Object.defineProperty(e,r,a)}function DeprecationError(e,r,t){var a,n=new Error;return Object.defineProperty(n,"constructor",{value:DeprecationError}),Object.defineProperty(n,"message",{configurable:!0,enumerable:!1,value:r,writable:!0}),Object.defineProperty(n,"name",{enumerable:!1,configurable:!0,value:"DeprecationError",writable:!0}),Object.defineProperty(n,"namespace",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(n,"stack",{configurable:!0,enumerable:!1,get:function(){return void 0!==a?a:a=createStackString.call(this,t)},set:function(e){a=e}}),n}var callSiteToString=require("./lib/compat").callSiteToString,eventListenerCount=require("./lib/compat").eventListenerCount,relative=require("path").relative;module.exports=depd;var basePath=process.cwd();