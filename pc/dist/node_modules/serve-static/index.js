/*!
 * serve-static
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * Copyright(c) 2014-2016 Douglas Christopher Wilson
 * MIT Licensed
 */

"use strict";function serveStatic(e,r){if(!e)throw new TypeError("root path required");if("string"!=typeof e)throw new TypeError("root path must be a string");var t=Object.create(r||null),n=t.fallthrough!==!1,o=t.redirect!==!1,a=t.setHeaders;if(a&&"function"!=typeof a)throw new TypeError("option setHeaders must be function");t.maxage=t.maxage||t.maxAge||0,t.root=resolve(e);var s=o?createRedirectDirectoryListener():createNotFoundDirectoryListener();return function(e,r,o){if("GET"!==e.method&&"HEAD"!==e.method)return n?o():(r.statusCode=405,r.setHeader("Allow","GET, HEAD"),r.setHeader("Content-Length","0"),void r.end());var i=!n,u=parseUrl.original(e),l=parseUrl(e).pathname;"/"===l&&"/"!==u.pathname.substr(-1)&&(l="");var c=send(e,l,t);c.on("directory",s),a&&c.on("headers",a),n&&c.on("file",function(){i=!0}),c.on("error",function(e){return!i&&e.statusCode<500?void o():void o(e)}),c.pipe(r)}}function collapseLeadingSlashes(e){for(var r=0;r<e.length&&"/"===e[r];r++);return r>1?"/"+e.substr(r):e}function createNotFoundDirectoryListener(){return function(){this.error(404)}}function createRedirectDirectoryListener(){return function(){if(this.hasTrailingSlash())return void this.error(404);var e=parseUrl.original(this.req);e.path=null,e.pathname=collapseLeadingSlashes(e.pathname+"/");var r=encodeUrl(url.format(e)),t='Redirecting to <a href="'+escapeHtml(r)+'">'+escapeHtml(r)+"</a>\n",n=this.res;n.statusCode=301,n.setHeader("Content-Type","text/html; charset=UTF-8"),n.setHeader("Content-Length",Buffer.byteLength(t)),n.setHeader("X-Content-Type-Options","nosniff"),n.setHeader("Location",r),n.end(t)}}var encodeUrl=require("encodeurl"),escapeHtml=require("escape-html"),parseUrl=require("parseurl"),resolve=require("path").resolve,send=require("send"),url=require("url");module.exports=serveStatic,module.exports.mime=send.mime;